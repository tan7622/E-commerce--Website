<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Track Order</title>
    <link rel="stylesheet" href="css/trackOrder.css">
    <script src="js/orderList.js"></script>
    <script src="js/medicine.js"></script>
</head>
<body>
    <div class="overlay">
        <div id='cross'>a</div>
        <div id='container2' class="container2">

        </div>
    </div>
    <div id='container' class="container">

    </div>
</body>
</html>

<script type="template">
    <div class="overlay">
        <div class="container2">
            <h2>Order 1</h2>
            <ul class="progressbar">
                <li class="active"></li>
                <li class="active"></li>
                <li class="current"></li>
                <li></li>
            </ul>
            <div class="container3">
                <div class="row">
                    <div style="width: 80%;">The package has been packed</div>
                    <div style="width: 20%; text-align: center;">
                        <h2>9 Feb</h2>
                        <h3>10AM</h3>
                    </div>
                </div>
                <div class="row">
                    <div style="width: 80%;">The package has been packed</div>
                    <div style="width: 20%; text-align: center;">
                        <h2>9 Feb</h2>
                        <h3>10AM</h3>
                    </div>
                </div>
            </div>
        </div>
    </div>
</script>
<script type="template">
    <div id='1' class="order">
        <div>Order 20</div>
        <div class="items">
            <div class="row">
                <div class="thumbnail">
                    <div class="menu-item"><img src="res/aspirin.jpg" style="max-width: 100%;"></div>
                </div>
                <div class="detail">
                    <div style="display: flex;">
                        <div style="width: 80%;">Aspirin</div>
                        <div style="width: 20%; text-align: right;">$12.99</div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="thumbnail">
                    <div class="menu-item"><img src="res/aspirin.jpg" style="max-width: 100%;"></div>
                </div>
                <div class="detail">
                    <div style="display: flex;">
                        <div style="width: 80%;">Aspirin</div>
                        <div style="width: 20%; text-align: right;">$12.99</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</script>

<script>
    const container = document.querySelector('#container');
    const container2 = document.querySelector('#container2');
    const overlay = document.querySelector('.overlay');
    const closeBtn = document.querySelector('#cross');

    closeBtn.addEventListener('click',()=>{
        overlay.style.display = 'none'
        document.body.style.overflow = 'auto'
        container2.innerHTML = ''
    })

    orderList.forEach(obj=>{
        let orderDiv = document.createElement('div')
        orderDiv.className = 'order'
        orderDiv.id = obj.id

        let orderNo = document.createElement('div')
        orderNo.classList = 'clickable'
        orderNo.innerHTML = 'Order ' + obj.id 

        let orderItems = document.createElement('div')
        orderItems.className = "items"

        orderDiv.append(orderNo)
        orderDiv.append(orderItems)

        container.append(orderDiv)

        obj.items.forEach(i => {
            let med = medicine.filter((m)=>{
                return m.id === i.id
            })

            let item = document.createElement('div')
            item.className = 'row'

            let div1 = document.createElement('div')
            div1.className = 'thumbnail'

            let thumbnail = document.createElement('div')
            thumbnail.className = 'menu-item'

            let image = document.createElement('img')
            image.src = med[0].path
            image.style.maxWidth = '100%'

            let div2 = document.createElement('div')
            div2.className = 'detail'
            
            let div3 = document.createElement('div')
            div3.style.display = 'flex'

            let name = document.createElement('div')
            name.innerHTML = med[0].medicine
            name.style.width = '80%'

            let price = document.createElement('div')
            price.innerHTML = '$' + med[0].price
            price.style.width = '20%'
            price.style.textAlign = 'right'

            div3.append(name)
            div3.append(price)
            div2.append(div3)

            div1.append(thumbnail)
            thumbnail.append(image)
            item.append(div1)
            item.append(div2)

            orderItems.append(item)
        })

        let summaryDiv = document.createElement('div')
        summaryDiv.className = "end"
        
        let a = document.createElement('div')
        a.innerHTML = 'Total'
        let btn = document.createElement('button')
        btn.innerHTML = 'Track'
        btn.onclick = ()=>{showTracker(obj)}

        summaryDiv.append(a)
        summaryDiv.append(btn)

        orderItems.append(summaryDiv)
    })

    const orders = document.querySelectorAll('.order')

    orders.forEach(element => {
        element.querySelector('.clickable').addEventListener('click', ()=>{
            element.classList.toggle('on')
        })
    });

    let messages = [
        'Your order has been received',
        'Your order has been packed',
        'Your order is being delivered',
        'Your order is delivered',
    ]
    
    function showTracker(order){
        overlay.style.display = 'flex';
        document.body.style.overflow = 'hidden'

        let orderNo = document.createElement('h2')
        orderNo.innerHTML = "Order " + order.id

        let progressBar = document.createElement('ul')
        progressBar.className = 'progressbar'
        
        let status = 0;
        order.status.received.date != ''    ?   status=0:null;
        order.status.packed.date != ''      ?   status=1:null;
        order.status.delivering.date != ''  ?   status=2:null;
        order.status.complete.date != ''    ?   status=3:null;

        for(let i=0; i<4; i++){
            let step = document.createElement('li')
            progressBar.append(step)
        }
        for(let i=0; i<=status; i++){
            let list = progressBar.querySelectorAll('li')
            list[i].className = 'active'
            list[status].className = 'current'
        }

        let statusContainer = document.createElement('div')
        statusContainer.className = 'container3'

        for(let i=0; i<=status; i++){
            let row = document.createElement('div')
            row.className = 'row'
            let message = document.createElement('div')
            message.className = 'message'
            let datetime = document.createElement('div')
            datetime.className = 'datetime'

            message.innerHTML = messages[i]
            let date = document.createElement('h2')
            let time = document.createElement('h3')

            if(i==0){
                date.innerHTML = order.status.received.date
                time.innerHTML = order.status.received.time
            }
            if(i==1){
                date.innerHTML = order.status.packed.date
                time.innerHTML = order.status.packed.time
            }
            if(i==2){
                date.innerHTML = order.status.delivering.date
                time.innerHTML = order.status.delivering.time
            }
            if(i==3){
                date.innerHTML = order.status.complete.date
                time.innerHTML = order.status.complete.time
            }

            datetime.append(date)
            datetime.append(time)

            row.append(message)
            row.append(datetime)
            statusContainer.append(row)
        }

        container2.append(orderNo)
        container2.append(progressBar)
        container2.append(statusContainer)
    }

</script>